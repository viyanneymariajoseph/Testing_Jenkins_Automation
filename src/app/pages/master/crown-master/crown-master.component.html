<div class="header pb-6">
  <div class="container-fluid">
    <div class=" header-body">
      <div class=" row align-items-center py-4">
        <div class=" col-lg-6 col-7">
          <nav aria-label="breadcrumb" class=" d-none d-md-inline-block ml-md-4" style="margin-top: 10px;">
            <ol class=" breadcrumb breadcrumb-links">
             <li class="breadcrumb-item">
                <a class="text-gray" [routerLink]="'/dashboards/dashboard'">
                  <i class="fas fa-home"></i>
                </a>
              </li>
              <li aria-current="page" class=" breadcrumb-item active">
                Documents Master
              </li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="container-fluid mt--6">
  <div class="row">
    <div class="col">
      <div class="card">
        <!-- <div class="card-header d-flex justify-content-end align-items-center">
          <a class="btn btn-sm btn-neutral" (click)="addDocumentType(addDocumentTypePopup)">
            <i class="fa fa-plus"></i>
            Add Document</a>
          <a class="btn btn-sm btn-neutral ml-2" (click)="addBranch(BranchFormPopup)">
            <i class="fa fa-plus"></i>
            Add Document Details</a>
        </div> -->

        <div class="dataTables_wrapper checklist-table w-100">
          <p-table #dt [paginator]="true" [rows]="10" [value]="formattedData" [autoLayout]="true"
            [showCurrentPageReport]="true" [rowsPerPageOptions]="[10, 25, 50, 100]" [(first)]="first"
            (onPage)="paginate($event)" [loading]="loading"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">
            <ng-template pTemplate="caption">
              <div class="d-flex justify-content-between align-items-center">
                <input type="text" pInputText size="50" placeholder="Search records" (input)="searchTable($event)"
                  class="global-search" />

                <div class="col-lg-6 col-5 text-right">
                  <a class="btn btn-sm btn-neutral btn-close-batch" (click)="addDocumentType(addDocumentTypePopup)">
                    <i class="fa fa-plus"></i>
                    Add Document</a>
                  <a class="btn btn-sm btn-neutral btn-close-batch" (click)="addBranch(BranchFormPopup)">
                    <i class="fa fa-plus"></i>
                    Add Document Details</a>
                  <a class="btn btn-sm btn-neutral btn-close-batch" (click)="downloadCSV()">
                    <i class="fa fa-download"></i>
                    Download</a>
                </div>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 10%">ACTION</th>
                <th *ngFor="let col of headerList; let i = index" [ngStyle]="i == 0 && { width: '5%' }">
                  {{ col.header }}
                  <p-sortIcon *ngIf="i == 10" [field]="col.field"></p-sortIcon>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-car let-rowIndex="rowIndex">
              <tr>
                <td>
                  <button type="button" style="padding: 0 0 5px 4px" class="btn btn-icon btn-icon-only"
                    title="Make Active/InActive" (click)="toggleDocStatus(car)">
                    <span class="btn-inner--icon">
                      <i class="fa" [ngClass]="car.Status === 'Active' ? 'fa-lock-open' : 'fa-lock'"></i>
                    </span>
                  </button>
                </td>

                <td *ngFor="let col of headerList">
                  <!-- if it's Status column, show badge instead of plain text -->
                  <ng-container *ngIf="col.field === 'Status'; else normalCell">
                    <span class="status-badge" [ngClass]="{
            'active-status': car.Status === 'Active',
            'inactive-status': car.Status === 'Inactive'
          }">
                      {{ car.Status }}
                    </span>
                  </ng-container>
                  <ng-template #normalCell>
                    {{ car[col.field] }}
                  </ng-template>
                </td>
              </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
              <tr>
                <td [attr.colspan]="headerList.length + 1" class="p-0">
                  <div class="d-flex justify-content-center align-items-center w-100" style="min-height: 200px;">
                    <h2 class="text-gray mb-0">Oops!, no data to show</h2>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>


      </div>
    </div>
  </div>
</div>

<ng-template #BranchFormPopup let-c="close" let-d="dismiss" let-modal>
  <div class="modal-content">
    <div class="modal-body p-0">
      <div class="card-header">
        <h3 class="mb-0">{{ isEditModeDocDetails ? 'Update Document Details' : 'Add Document Details' }}</h3>
        <!-- </div> -->

        <div class="card-body">
          <form [formGroup]="AddBranchForm" (ngSubmit)="onSubmitDetails()">
            <div class="form-row">
              <div class="form-group col-md-12 mb-3">
                <label class="form-control-label" for="Branch">
                  Detail Document Type
                </label>
                <input class="form-control" formControlName="detailDocType" placeholder="Detail Document Type"
                  type="text" [ngClass]="{
      'is-invalid':
        FormControls['detailDocType'].invalid &&
        (FormControls['detailDocType'].touched || submitted)
    }" />

                <!-- Invalid Spaces -->
                <div *ngIf="AddBranchForm.controls.detailDocType.errors?.invalidSpaces">
                  * No leading/trailing or multiple spaces allowed.
                </div>

                <!-- Reactive Form Validation Messages -->
                <div *ngIf="
      FormControls['detailDocType'].invalid &&
      (FormControls['detailDocType'].touched || submitted)
    " class="invalid-feedback">

                  <div *ngIf="FormControls['detailDocType'].hasError('required')">
                    * Detail Document Type is required.
                  </div>
                  <div *ngIf="FormControls['detailDocType'].hasError('whitespace')">
                    * Detail Document Type cannot be empty or spaces.
                  </div>
                  <div *ngIf="FormControls['detailDocType'].hasError('onlyNumber')">
                    * Detail Document Type cannot be only numbers.
                  </div>
                   <div *ngIf="FormControls['detailDocType'].hasError('onlySpecialChars')">
                    *Detail Document Type cannot contain only special characters. Include letters or numbers.
                  </div>
                  <div *ngIf="FormControls['detailDocType'].hasError('specialCharacterNotAllowed')">
                    * Special characters are not allowed. Allowed: letters (including non-Latin like Chinese), numbers,
                    spaces, cannot allows ","
                  </div>

                </div>
              </div>

              <div class="col-md-12 mb-3">
                <label class="form-control-label" for="Branch">
                  Document Type
                </label>
                <select class="form-select" data-toggle="select" formControlName="DocType" [ngClass]="{
                  'is-invalid':
                    FormControls['DocType'].invalid &&
                    (FormControls['DocType'].touched || submitted)
                }">
                  <option value="" selected disabled>--Select--</option>
                  <option *ngFor="let _User of AllCrownBranch" [value]="_User.Id">
                    {{ _User.DocumentType }}
                  </option>
                </select>
                <div *ngIf="
                  FormControls['DocType'].invalid &&
                  (FormControls['DocType'].touched || submitted)
                " class="invalid-feedback">
                  <div *ngIf="FormControls['DocType'].hasError('required')">
                    * Document Type is required.
                  </div>
                </div>
              </div>
              <div class="col-md-12 mb-3">
                <label class="form-control-label" for="Branch">
                  Retention Period
                </label>
                <select class="form-select" data-toggle="select" formControlName="retention_period" [ngClass]="{
                  'is-invalid':
                    FormControls['retention_period'].invalid &&
                    (FormControls['retention_period'].touched || submitted)
                }">
                  <option value="" selected disabled>--Select--</option>
                  <option value="1">1 Year</option>
                  <option value="2">2 Years</option>
                  <option value="3">3 Years</option>
                  <option value="4">4 Years</option>
                  <option value="5">5 Years</option>
                  <option value="6">6 Year</option>
                  <option value="7">7 Years</option>
                  <option value="8">8 Years</option>
                  <option value="9">9 Years</option>
                  <option value="10">10 Years</option>
                  <option value="11">11 Year</option>
                  <option value="12">12 Years</option>
                  <option value="13">13 Years</option>
                  <option value="14">14 Years</option>
                  <option value="15">15 Years</option>
                  <option value="16">16 Year</option>
                  <option value="17">17 Years</option>
                  <option value="18">18 Years</option>
                  <option value="19">19 Years</option>
                  <option value="20">20 Years</option>
                  <option value="NA">NA</option>
                </select>
                <div *ngIf="
                  FormControls['retention_period'].invalid &&
                  (FormControls['retention_period'].touched || submitted)
                " class="invalid-feedback">
                  <div *ngIf="FormControls['retention_period'].hasError('required')">
                    * Retention Period is required.
                  </div>
                </div>
              </div>
              <div class="col-md-12 mb-3">
                <label class="form-control-label" for="Branch">
                  Department Code
                </label>
                <select class="form-select" data-toggle="select" formControlName="branch_code" [ngClass]="{
                  'is-invalid':
                    FormControls['branch_code'].invalid &&
                    (FormControls['branch_code'].touched || submitted)
                }">
                  <option value="" selected disabled>--Select--</option>
                  <option *ngFor="let _User of AllDeptCode" [value]="_User.departmentID">
                    {{ _User.DepartmentCode }}
                  </option>
                </select>
                <div *ngIf="
                  FormControls['branch_code'].invalid &&
                  (FormControls['branch_code'].touched || submitted)
                " class="invalid-feedback">
                  <div *ngIf="FormControls['branch_code'].hasError('required')">
                    * Department Code is required.
                  </div>
                </div>
              </div>
            </div> <button class="btn btn-outline-success" type="submit" [disabled]="AddBranchForm.invalid">
              Submit
            </button>
            <button type="button" class="btn btn-outline-danger" (click)="OnReset()">
              Close
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #addDocumentTypePopup let-c="close" let-d="dismiss" let-modal>
  <div class="modal-content">
    <div class="modal-body p-0">
      <div class="card-header">
        <h3 class="mb-0">{{ isEditModeDoc ? 'Update Document Type' : 'Add Document Type' }}</h3>
        <!-- </div> -->

        <div class="card-body">
          <form [formGroup]="AddBranchForm" (ngSubmit)="onSubmit()">
            <div class="form-row">
              <div class="col-md-12 mb-3">
                <label class="form-control-label" for="Branch">
                  Document Type
                </label>
                <input class="form-control" id="Branch Name" formControlName="branch_name" placeholder="Document Type"
                  type="text" [ngClass]="{
                  'is-invalid':
                    FormControls['branch_name'].invalid &&
                    (FormControls['branch_name'].touched || submitted)
                }" />
                <div *ngIf="AddBranchForm.controls.branch_name.errors?.invalidSpaces">
                  * No leading/trailing or multiple spaces allowed.
                </div>
                <div *ngIf="
                  FormControls['branch_name'].invalid &&
                  (FormControls['branch_name'].touched || submitted)
                " class="invalid-feedback">
                  <div *ngIf="FormControls['branch_name'].hasError('required')">
                    * Document Type is required.
                  </div>
                  <div *ngIf="FormControls['branch_name'].hasError('onlySpecialChars')">
                    * Document Type cannot contain only special characters. Include letters or numbers.
                  </div>

                  <div *ngIf="FormControls['branch_name'].hasError('whitespace')">
                    * Document Type cannot be just spaces.
                  </div>
                  <div
                    *ngIf="FormControls['branch_name'].hasError('onlyNumber') || FormControls['branch_name'].hasError('specialCharacterNotAllowed')">
                    * Invalid input. Document Type cannot be only numbers and may only contain letters (including
                    non-Latin), numbers, spaces, cannot allows ","
        
                  </div>


                </div>


              </div>
            </div>
            <button class="btn btn-outline-success" type="submit" [disabled]="AddBranchForm.invalid">
              Submit
            </button>


            <button type="button" class="btn btn-outline-danger" (click)="OnReset()">
              Close
            </button>
          </form>
        </div>
        <!-- </div> -->
      </div>
    </div>
  </div>
</ng-template>