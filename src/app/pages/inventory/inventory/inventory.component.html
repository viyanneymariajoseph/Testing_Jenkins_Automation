<div class="header pb-6">
  <div class="container-fluid">
    <div class=" header-body">
      <div class=" row align-items-center py-4">
        <div class=" col-lg-6 col-7">
          <nav aria-label="breadcrumb" class=" d-none d-md-inline-block ml-md-4" style="margin-top: 10px;">
            <ol class=" breadcrumb breadcrumb-links">
              <li class="breadcrumb-item">
                <a class="text-gray" [routerLink]="'/dashboards/dashboard'">
                  <i class="fas fa-home"></i>
                </a>
              </li>
              <li aria-current="page" class=" breadcrumb-item active">
                Carton Inventory
              </li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid mt--6">
  <div class="row">
    <!-- <div class="col"> -->
    <div class="card">
      <!-- 
    <div class="card-header d-flex justify-content-end align-items-center">
  <a class="btn btn-sm btn-neutral btn-yellow-hover" [routerLink]="['/inventory/create-inventory']">
    <i class="fa fa-plus"></i>&nbsp;Create Inventory
  </a>
  <a class="btn btn-sm btn-neutral btn-yellow-hover ml-2" [routerLink]="['/inventory/bulk-inventory']">
    <i class="fa fa-upload"></i>&nbsp;Bulk Inventory
  </a>
</div> -->


      <div class="dataTables_wrapper checklist-table w-100">
        <p-table [paginator]="true" [rows]="10" [value]="formattedData" [autoLayout]="true"
          [showCurrentPageReport]="true" [rowsPerPageOptions]="[10, 25, 50, 100]" [(first)]="first"
          (onPage)="paginate($event)" [loading]="loading"
          currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">
          <ng-template pTemplate="caption">
            <div class="d-flex justify-content-between align-items-center w-100">

              <!-- Global Search -->
              <input type="text" pInputText placeholder="Search records" (input)="searchTable($event)"
                class="form-control global-search search" style="
        height: 36px;
        font-size: 15px;
        width: 320px;
        max-width: 100%;
      " />

              <!-- Right side: Carton Search + Create & Bulk Inventory -->
              <div class="d-flex align-items-center gap-2 justify-content-end">

                <!-- Carton Search -->
                <input type="text" pInputText class="form-control" style="
          height: 36px;
          font-size: 12px;
          width: 200px;
          max-width: 100%;
          margin-right: 12px;
        " placeholder="Search By Carton No" [(ngModel)]="cartonNumber" />
                <a class="btn btn-sm btn-neutral btn-close-batch" (click)="searchByCartonNumber()"
                  [class.disabled]="!cartonNumber" [attr.disabled]="!cartonNumber ? true : null">
                  <i class="fa fa-search"></i>&nbsp;Search
                </a>


                <!-- Create Inventory -->
                <a class="btn btn-sm btn-neutral btn-close-batch" [routerLink]="['/inventory/create-inventory']">
                  <i class="fa fa-plus"></i>&nbsp;Create Inventory
                </a>

                <!-- Bulk Inventory -->
                <a class="btn btn-sm btn-neutral btn-close-batch" [routerLink]="['/inventory/bulk-inventory']">
                  <i class="fa fa-upload"></i>&nbsp;Bulk Inventory
                </a>
              </div>

            </div>
          </ng-template>
          <ng-template pTemplate="header">
            <tr>
              <!-- ACTION column first -->
              <th style="width: 5%; white-space: nowrap">ACTION</th>

              <!-- SR NO column -->
              <th style="width: 5%; white-space: nowrap">SR NO</th>

              <!-- Dynamic headers -->
              <th *ngFor="let col of headerList; let i = index" [ngStyle]="i == 0 && { width: '5%' }"
                style="white-space: nowrap">
                {{ col.header }}
              </th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-car let-rowIndex="rowIndex">
            <tr>
              <!-- ACTION column first -->
              <td style="white-space: nowrap">
                <a type="button" style="padding:0 0 5px 4px; border-radius: 50%; background-color: white;"
                  tooltip="View Batch Details" class="btn btn-icon btn-icon-only" (click)="View(InventoryPopup, car)">
                  <span class="btn-inner--icon"><i class="fa fa-eye"></i></span>
                </a>
              </td>

              <!-- SR NO -->
              <td>
                {{ car["srNo"] }}
              </td>

              <!-- Dynamic data columns -->
              <td *ngFor="let col of headerList" style="white-space: nowrap">
                <ng-container *ngIf="col.field === 'status'; else normalCell">
                  <span class="status-badge" [ngClass]="getStatusClass(car[col.field])">
                    {{ car[col.field] }}
                  </span>
                </ng-container>
                <ng-template #normalCell>
                  {{ car[col.field] }}
                </ng-template>
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td [attr.colspan]="headerList.length + 1" class="p-0">
                <div class="d-flex justify-content-center align-items-center w-100" style="min-height: 200px;">
                  <h2 class="text-gray mb-0">Oops!, no data to show</h2>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
    <!-- </div> -->
  </div>
</div>


<ng-template #InventoryPopup let-c="close" let-d="dismiss" let-modal>
  <div class="modal-content">
    <div class="modal-body p-0">
      <!-- <div class="card"> -->

      <button type="button" class="btn-close float-right mr-3 mt-3  red-close" data-bs-dismiss="modal"
        aria-label="Close" (click)="modalRef.hide()"></button>
      <div class="card-header">
        <h3 class="mb-0">View Batch Details</h3>
        <!-- </div> -->
        <div class="card-body">
          <!-- <div class="dataTables_wrapper py-4 checklist-table"> -->
          <p-table [paginator]="true" [rows]="10" [value]="formattedData1" [autoLayout]="true"
            [showCurrentPageReport]="true" [rowsPerPageOptions]="[10, 25, 50, 100]" [(first)]="first1"
            (onPage)="paginate1($event)" [loading]="loading"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">
            <ng-template pTemplate="caption">
              <div class="d-flex align-items-center justify-content-between w-100">
                <input type="text" pInputText size="50" class="form-control" placeholder="Search records"
                  (input)="searchTable1($event)" class="global-search search" />

                <button type="button" class="btn btn-sm btn-neutral btn-grey-hover ml-2" (click)="downloadFile()"
                  [ngStyle]=" !formattedData?.length
              ? { opacity: 0.6, cursor: 'not-allowed' }
              : {}
              ">
                  Download
                </button>

              </div>
            </ng-template>

            <ng-template pTemplate="header">
              <tr>
                <th style="width: 10%" style="white-space: nowrap">SR NO</th>
                <th *ngFor="let col of headerList1; let i = index" [ngStyle]="i == 0 && { width: '5%' }"
                  style="white-space: nowrap">
                  {{ col.header }}
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-car let-rowIndex="rowIndex">
              <tr>
                <td>
                  {{ car["srNo"] }}
                </td>

                <td *ngFor="let col of headerList1" style="white-space: nowrap">
                  <!-- âœ… Apply getStatusClass only for status column -->
                  <ng-container *ngIf="col.field === 'status'; else normalCell">
                    <span class="status-badge" [ngClass]="getStatusClass(car[col.field])">
                      {{ car[col.field] }}
                    </span>
                  </ng-container>

                  <ng-template #normalCell>
                    {{ car[col.field] }}
                  </ng-template>
                </td>
              </tr>
            </ng-template>

          </p-table>
          <!-- </div> -->
        </div>
      </div>
    </div>
  </div>
</ng-template>